<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>æ•™æé–±è®€å€ - AIç”Ÿæ´»æ‡‰ç”¨åˆ†äº«</title>
  <link rel="stylesheet" href="assets/style.css">
  <!-- å¼•å…¥ pdf.js -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.9.179/pdf.min.js"></script>
  <script>
    pdfjsLib.GlobalWorkerOptions.workerSrc =
      'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.9.179/pdf.worker.min.js';
  </script>
</head>
<body class="container">
  <header>
    <h1>ğŸ“„ æ•™æé–±è®€å€</h1>
    <nav>
      <ul>
        <li><a href="index.html">ğŸ  è¿”å›é¦–é </a></li>
        <li><a href="about_me.html">é—œæ–¼æˆ‘</a></li>
        <li><a href="stats.html">è¨ªå•çµ±è¨ˆ</a></li>
        <li><a href="comments.html">ç•™è¨€æ¿</a></li>
        <li><a href="search.html">æœå°‹</a></li>
        <li><a href="publications.html">æˆ‘çš„å‡ºç‰ˆå“</a></li>
        <li><a href="resources.html">æ¨è–¦è³‡æº</a></li>
      </ul>
    </nav>
  </header>

  <main class="container">
    <div class="sidebar">
      <select id="pdfSelect" size="15"></select>
      <button onclick="prevPDF()">â¬…ï¸ ä¸Šä¸€é …</button>
      <button onclick="nextPDF()">â¡ï¸ ä¸‹ä¸€é …</button>
    </div>
    <div style="flex: 1;">
      <canvas id="pdfCanvas"></canvas>
      <div class="status" id="statusText">å°šæœªé¸æ“‡ PDF</div>
      <div style="margin-top: 10px;">
        <button onclick="prevPage()">ğŸ“„ ä¸Šä¸€é </button>
        <button onclick="nextPage()">ğŸ“„ ä¸‹ä¸€é </button>
        <span id="pageInfo" style="margin-left: 10px; font-weight: bold;"></span>
      </div>
      <div id="stats">
        <div class="stat-block">ğŸ‘ï¸ é»é–±ï¼š<span id="viewCount">00000</span></div>
        <div class="stat-block">ğŸ‘ æŒ‰è®šï¼š<span id="likeCount">00000</span></div>
        <button id="likeBtn" onclick="likePDF()">ğŸ‘</button>
      </div>
    </div>
  </main>

  <script>
    const manifestURL = './data/manifest.json';
    let pdfList = [];
    let currentIndex = -1;
    let currentPage = 1;
    let totalPages = 1;
    let currentPDF = null;

    async function loadPDFList() {
      try {
        const res = await fetch(manifestURL);
        const data = await res.json();
        if (!Array.isArray(data)) throw new Error('manifest.json æ‡‰ç‚ºé™£åˆ—æ ¼å¼');
        pdfList = data;

        const select = document.getElementById('pdfSelect');
        select.innerHTML = '';
        pdfList.forEach((item, index) => {
          const option = document.createElement('option');
          option.value = index;
          option.textContent = item.title;
          select.appendChild(option);
        });

        if (pdfList.length > 0) showPDF(0);
      } catch (err) {
        console.error('è¼‰å…¥éŒ¯èª¤ï¼š', err);
        document.getElementById('statusText').textContent = 'âŒ ç„¡æ³•è¼‰å…¥ PDF æ¸…å–®';
      }
    }

    function showPDF(index) {
      if (index < 0 || index >= pdfList.length) return;
      currentIndex = index;
      currentPage = 1;

      const fileURL = pdfList[index].url;
      document.getElementById('statusText').textContent = 'â³ è¼‰å…¥ä¸­â€¦';

      pdfjsLib.getDocument(fileURL).promise.then(pdf => {
        currentPDF = pdf;
        totalPages = pdf.numPages;
        renderPage(currentPage);
        document.getElementById('statusText').textContent =
          `ğŸ“˜ ç¬¬ ${index + 1} é … / å…± ${pdfList.length} é …ï¼š${pdfList[index].title}`;
      }).catch(err => {
        console.error('PDF è¼‰å…¥å¤±æ•—ï¼š', err.message);
        document.getElementById('statusText').textContent =
          'âŒ ç„¡æ³•é¡¯ç¤º PDFï¼š' + err.message;
      });

      document.getElementById('pdfSelect').value = index;
      pdfList[index].views = (pdfList[index].views || 0) + 1;
      updateStats(index);
    }

    function renderPage(pageNum) {
      currentPDF.getPage(pageNum).then(page => {
        const scale = 1.5;
        const viewport = page.getViewport({ scale });
        const canvas = document.getElementById('pdfCanvas');
        const context = canvas.getContext('2d');
        canvas.height = viewport.height;
        canvas.width = viewport.width;

        const renderContext = { canvasContext: context, viewport: viewport };
        page.render(renderContext);
        document.getElementById('pageInfo').textContent =
          `ğŸ“„ ç¬¬ ${pageNum} é  / å…± ${totalPages} é `;
      });
    }

    function prevPage() {
      if (currentPDF && currentPage > 1) {
        currentPage--;
        renderPage(currentPage);
      }
    }
    function nextPage() {
      if (currentPDF && currentPage < totalPages) {
        currentPage++;
        renderPage(currentPage);
      }
    }
    function prevPDF() {
      if (currentIndex > 0) showPDF(currentIndex - 1);
    }
    function nextPDF() {
      if (currentIndex < pdfList.length - 1) showPDF(currentIndex + 1);
    }
    function likePDF() {
      if (currentIndex >= 0) {
        pdfList[currentIndex].likes =
          (pdfList[currentIndex].likes || 0) + 1;
        updateStats(currentIndex);
      }
    }
    function updateStats(index) {
      const item = pdfList[index];
      document.getElementById('viewCount').textContent =
        String(item.views || 0).padStart(5, '0');
      document.getElementById('likeCount').textContent =
        String(item.likes || 0).padStart(5, '0');
    }

    document.getElementById('pdfSelect').addEventListener('change', function () {
      const index = parseInt(this.value);
      if (!isNaN(index)) showPDF(index);
    });

    loadPDFList();
  </script>

  <footer style="margin-top: 40px; padding: 20px; text-align: center;">
    <p>&copy; 2026 AIç”Ÿæ´»æ‡‰ç”¨åˆ†äº«</p>
  </footer>
</body>
</html>
